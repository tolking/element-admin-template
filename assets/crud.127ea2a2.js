import{a as h,b as B,c as D,d as C,e as k,R as G,f as K,r as L,g as M,h as O,i as j}from"./index.f3cb3dbf.js";import{a as d,c as q,u as s,w as P}from"./modules-vue.943a6a3f.js";import{e as E}from"./modules-vueuse.ef6c1357.js";const W={login:"/admin/login",user:"/admin/user",userStatus:"/admin/user/{id}/status",article:"/admin/article",goods:"/admin/goods",cates:"/admin/goods/cates",form:"/admin/form"};function z({url:n,transform:r,showTip:e=!0,type:t="post",afterSubmit:c}){const i=d(!1),u=d({}),a=d({}),o=q(()=>L(s(n),a.value.id)),l=h(n,a),m=B(o,a),w=async(v,g)=>{if(g){const p=await A();p.value?s(e)&&D("success","\u63D0\u4EA4\u6210\u529F\uFF01"):p.value!==null&&s(e)&&D("warning","\u63D0\u4EA4\u5931\u8D25\uFF01"),E(c)&&c(p.value)}v()};async function A(v=t){return F(),i.value=!0,s(v)==="post"?(await l.execute(),i.value=!1,l.data):(await m.execute(),i.value=!1,m.data)}function F(){a.value=E(r)?r(s(u)):u.value}return{isFetching:i,form:u,submit:w,submitForm:A}}function H({url:n,immediate:r=!0}){const e=d(void 0),t=q(()=>L(s(n),e.value)),{isFetching:c,data:i,execute:u}=C(t);s(r)&&P(e,o=>{o!==void 0&&a()});async function a(){c.value||await u()}return{isFetching:c,detailId:e,detail:i,loadDetail:a}}function J({url:n,immediate:r=!1,showTip:e=!0}){const t=d(void 0),c=q(()=>L(s(n),t.value)),{isFetching:i,data:u,execute:a}=M(c);s(r)&&P(t,l=>{l!==void 0&&o()});function o(){return O("\u8B66\u544A","\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u9879\u5417?",{type:"warning"}).then(async()=>(await a(),u.value?(t.value=void 0,s(e)&&D("success","\u5220\u9664\u6210\u529F!")):s(e)&&D("warning","\u5220\u9664\u5931\u8D25!"),u)).catch(()=>{t.value=void 0,D("info","\u5DF2\u53D6\u6D88\u64CD\u4F5C")})}return{isFetching:i,deleteId:t,submitDelete:o}}function N({url:n,transform:r,immediate:e=!0}){const t=d(1),c=d(j),i=d(0),u=d({}),a=d({}),{isFetching:o,data:l,execute:m}=C(n,a),w=d([]),A=async(g,p)=>{p&&(t.value=1,await F()),g()};s(e)&&F();async function F(){o.value||(v(),await m(),l.value&&(k(),w.value=l.value.list,i.value=l.value.total))}function v(){const g=E(r)?r(s(u)):u.value;a.value={...g,[G]:t.value,[K]:c.value}}return{query:u,isFetching:o,page:t,limit:c,total:i,list:w,search:A,loadList:F}}function X({url:n,immediate:r=!0,showTip:e=!0,syncDetail:t=!1,transform:c,transformQuery:i,transformDetail:u,afterSubmit:a}){const o=N({url:n,immediate:r,transform:i}),{form:l,submitForm:m}=z({url:n,showTip:e,transform:c}),{deleteId:w,submitDelete:A}=J({url:n,showTip:e}),{detailId:F,detail:v,loadDetail:g}=H({url:n,immediate:!1}),p=async(x,b,y)=>{if(b==="edit"||b==="detail"){let f={...y};s(t)&&(f==null?void 0:f.id)&&(F.value=f.id,await g(),v.value&&(f=v.value)),l.value=E(u)?u(f):f}else l.value={};x()},R=async(x,b,y,f)=>{if(f){const I=await m(y==="add"?"post":"put");I.value?(e&&D("success","\u63D0\u4EA4\u6210\u529F\uFF01"),o.loadList(),x()):I.value!==null&&e&&D("warning","\u63D0\u4EA4\u5931\u8D25\uFF01"),E(a)&&a(I.value)}b()};async function _(x){const b=x;w.value=b.id;const y=await A();y!=null&&y.value&&o.loadList()}return{...o,form:l,beforeOpen:p,submit:R,submitForm:m,deleteRow:_}}export{W as A,N as a,H as b,X as c,z as u};
