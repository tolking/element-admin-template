import{R as B,u as R,r as C,a as E,b as M,c as A}from"./index-b885c862.js";/* empty css                  */import{af as G,ag as S}from"./modules-element-plus-e2fc2490.js";import{i as H,D as K,l as Q,m as x}from"./modules-vueuse-38da200c.js";import{c as _,u as i,aB as z,r as f,w as $}from"./modules-vue-39e66fd2.js";function v(e,t,s={}){return G(Object.assign(s,{type:e,message:t}))}function N(e,t,s={}){return S.confirm(e,t,s)}function U(e){return/\/$/.test(e)?e:e+"/"}function D(e,...t){const[s,...n]=t;if(s!==void 0&&/\{\w*\}/.test(e))e=e.replace(/\{\w*\}/,String(s));else if(s!==void 0)e=U(e)+s;else return e;return D(e,...n)}function V(){H&&window.scrollTo({left:0,top:0,behavior:"smooth"})}const W="https://api.virapi.com/vir_github21e78h6b5d24e",I=K({baseUrl:W,options:{immediate:!1,timeout:B,beforeFetch({options:e}){return R(),e.headers=Object.assign(e.headers||{},{"app-token":"$2a$10$oWYgEw/X1hj9BbvejQOud.xFezq5wP8H7NGkVA.4HcChK928Z2nja"}),{options:e}},afterFetch({data:e,response:t}){const s=R(),n=e.code;return n===200?e=e.data||{}:n===401?(s.value={token:"",name:"",avatar:""},v("warning","登陆已经过期"),setTimeout(()=>{C.push("/login")},1500),e=null):n===1e3?(console.error(e.message),v("warning",e.message),e=null):n&&(console.log("出现未全局拦截错误"),e=void 0),{data:e,response:t}},onFetchError({data:e,error:t}){return console.error(t),e=void 0,{data:e,error:t}}},fetchOptions:{mode:"cors",credentials:"same-origin"}});function L(e,t){const s=_(()=>{const n=i(e),a=i(t),o=Q(a)?z(a):a||"";return`${n}${o?"?":""}${o}`});return I(s).json()}function X(e,t){return I(e).post(t).json()}function Y(e,t){return I(e).put(t).json()}function Z(e,t){return I(e).delete(t).json()}function J({url:e,transform:t,showTip:s=!0,type:n="post",afterSubmit:a}){const o=f(!1),u=f({}),c=f({}),r=_(()=>D(i(e),c.value.id)),l=X(e,c),g=Y(r,c),b=async(m,w)=>{if(w){const y=await F();y.value?i(s)&&v("success","提交成功！"):y.value!==null&&i(s)&&v("warning","提交失败！"),x(a)&&a(y.value)}m()};async function F(m=n){return p(),o.value=!0,i(m)==="post"?(await l.execute(),o.value=!1,l.data):(await g.execute(),o.value=!1,g.data)}function p(){c.value=x(t)?t(i(u)):u.value}return{isFetching:o,form:u,submit:b,submitForm:F}}function T({url:e,immediate:t=!0}){const s=f(void 0),n=_(()=>D(i(e),s.value)),{isFetching:a,data:o,execute:u}=L(n);i(t)&&$(s,r=>{r!==void 0&&c()});async function c(){a.value||await u()}return{isFetching:a,detailId:s,detail:o,loadDetail:c}}function ee({url:e,immediate:t=!1,showTip:s=!0}){const n=f(void 0),a=_(()=>D(i(e),n.value)),{isFetching:o,data:u,execute:c}=Z(a);i(t)&&$(n,l=>{l!==void 0&&r()});function r(){return N("警告","您确定要删除该项吗?",{type:"warning"}).then(async()=>(await c(),u.value?(n.value=void 0,i(s)&&v("success","删除成功!")):i(s)&&v("warning","删除失败!"),u)).catch(()=>{n.value=void 0,v("info","已取消操作")})}return{isFetching:o,deleteId:n,submitDelete:r}}function te({url:e,transform:t,immediate:s=!0}){const n=f(1),a=f(E),o=f(0),u=f({}),c=f({}),{isFetching:r,data:l,execute:g}=L(e,c),b=f([]),F=async(w,y)=>{y&&(n.value=1,await p()),w()};i(s)&&p();async function p(){r.value||(m(),await g(),l.value&&(V(),b.value=l.value.list,o.value=l.value.total))}function m(){const w=x(t)?t(i(u)):u.value;c.value={...w,[M]:n.value,[A]:a.value}}return{query:u,isFetching:r,page:n,limit:a,total:o,list:b,search:F,loadList:p}}function ue({url:e,immediate:t=!0,showTip:s=!0,syncDetail:n=!1,transform:a,transformQuery:o,transformDetail:u,afterSubmit:c}){const r=te({url:e,immediate:t,transform:o}),{form:l,submitForm:g}=J({url:e,showTip:s,transform:a}),{deleteId:b,submitDelete:F}=ee({url:e,showTip:s}),{detailId:p,detail:m,loadDetail:w}=T({url:e,immediate:!1}),y=async(q,j,h)=>{if(j==="edit"||j==="detail"){let d={...h};i(n)&&(d!=null&&d.id)&&(p.value=d.id,await w(),m.value&&(d=m.value)),l.value=x(u)?u(d):d}else l.value={};q()},P=async(q,j,h,d)=>{if(d){const O=await g(h==="add"?"post":"put");O.value?(s&&v("success","提交成功！"),r.loadList(),q()):O.value!==null&&s&&v("warning","提交失败！"),x(c)&&c(O.value)}j()};async function k(q){const j=q;b.value=j.id;const h=await F();h!=null&&h.value&&r.loadList()}return{...r,form:l,beforeOpen:y,submit:P,submitForm:g,deleteRow:k}}const ce={login:"/admin/login",user:"/admin/user",userStatus:"/admin/user/{id}/status",article:"/admin/article",goods:"/admin/goods",cates:"/admin/goods/cates",form:"/admin/form"};export{ce as A,te as a,v as b,T as c,ue as d,L as e,J as u};
