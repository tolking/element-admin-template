import{u as _}from"./list-Lq4y2q8E.js";import{u as M}from"./form-CzUEu54E.js";import{r as O,u as j,b as k,a as c}from"./api-P98th4it.js";import{r as q,c as z,u as l,w as A}from"./modules-vue-By89M0U-.js";import{u as B}from"./detail-Bffu2ejE.js";import{s as y}from"./modules-vueuse-Btdjl5qo.js";function E({url:o,immediate:v=!1,showTip:a=!0}){const t=q(void 0),p=z(()=>O(l(o),t.value)),{data:d,execute:f,...m}=j(p);l(v)&&A(t,n=>{n!==void 0&&u()});function u(){return k("警告","您确定要删除该项吗?",{type:"warning"}).then(async()=>(await f(),d.value?(t.value=void 0,l(a)&&c("success","删除成功!")):l(a)&&c("warning","删除失败!"),d)).catch(()=>{t.value=void 0,c("info","已取消操作")})}return{...m,deleteId:t,submitRemove:u}}function Q({url:o,immediate:v=!0,showTip:a=!0,syncDetail:t=!1,transform:p,transformQuery:d,transformDetail:f,afterSubmit:m}){const u=_({url:o,immediate:v,transform:d}),{form:n,submitForm:b}=M({url:o,showTip:a,transform:p}),{deleteId:I,submitRemove:R}=E({url:o,showTip:a}),{detailId:C,detail:g,loadDetail:F}=B({url:o,immediate:!1}),L=async(r,i,s)=>{if(i==="edit"||i==="detail"){let e={...s};l(t)&&(e!=null&&e.id)&&(C.value=e.id,await F(),g.value&&(e=g.value)),n.value=y(f)?f(e):e}else n.value={};r()},x=async(r,i,s,e)=>{if(e){const w=await b(s==="add"?"post":"put");w.value?(a&&c("success","提交成功！"),u.loadList(),r()):w.value!==null&&a&&c("warning","提交失败！"),y(m)&&m(w.value)}i()};async function D(r){const i=r;I.value=i.id;const s=await R();s!=null&&s.value&&u.loadList()}return{...u,form:n,beforeOpen:L,submit:x,submitForm:b,deleteRow:D}}export{Q as u};
