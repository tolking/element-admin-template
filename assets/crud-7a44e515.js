import{u as _}from"./list-66928616.js";import{u as M}from"./form-de1a726c.js";import{r as O,u as j,b as k,a as l}from"./api-c58faca4.js";import{r as q,c as z,u as c,w as A}from"./modules-vue-1e7a0b2d.js";import{u as B}from"./detail-8b6b9377.js";import{m as y}from"./modules-vueuse-b11b28df.js";function E({url:o,immediate:v=!1,showTip:a=!0}){const t=q(void 0),p=z(()=>O(c(o),t.value)),{data:d,execute:m,...f}=j(p);c(v)&&A(t,n=>{n!==void 0&&u()});function u(){return k("警告","您确定要删除该项吗?",{type:"warning"}).then(async()=>(await m(),d.value?(t.value=void 0,c(a)&&l("success","删除成功!")):c(a)&&l("warning","删除失败!"),d)).catch(()=>{t.value=void 0,l("info","已取消操作")})}return{...f,deleteId:t,submitRemove:u}}function Q({url:o,immediate:v=!0,showTip:a=!0,syncDetail:t=!1,transform:p,transformQuery:d,transformDetail:m,afterSubmit:f}){const u=_({url:o,immediate:v,transform:d}),{form:n,submitForm:g}=M({url:o,showTip:a,transform:p}),{deleteId:I,submitRemove:R}=E({url:o,showTip:a}),{detailId:C,detail:b,loadDetail:D}=B({url:o,immediate:!1}),F=async(r,i,s)=>{if(i==="edit"||i==="detail"){let e={...s};c(t)&&(e!=null&&e.id)&&(C.value=e.id,await D(),b.value&&(e=b.value)),n.value=y(m)?m(e):e}else n.value={};r()},L=async(r,i,s,e)=>{if(e){const w=await g(s==="add"?"post":"put");w.value?(a&&l("success","提交成功！"),u.loadList(),r()):w.value!==null&&a&&l("warning","提交失败！"),y(f)&&f(w.value)}i()};async function x(r){const i=r;I.value=i.id;const s=await R();s!=null&&s.value&&u.loadList()}return{...u,form:n,beforeOpen:F,submit:L,submitForm:g,deleteRow:x}}export{Q as u};
